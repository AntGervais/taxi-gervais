---
const reviews = [
  {
    author: "Am√©lie Laurin",
    rating: 5,
    text: "Anthony est un excellent conducteur, ponctuel, fiable. Il est tr√®s sympathique et c'est agr√©able de discuter avec lui. Je recommande vivement de faire appel √† lui pour vos d√©placements. Le meilleur chauffeur de taxi que j'aie rencontr√©.",
    date: "Il y a 1 mois",
  },
  {
    author: "Catherine Testa",
    rating: 5,
    text: "Super !! Je recommande +++. Un des rares taxis √† prendre les r√©servations √† la roche sur Yon ! √Ä l'heure !",
    date: "Il y a 4 mois",
  },
  {
    author: "Jean-Luc Moreau",
    rating: 5,
    text: "Chauffeur tr√®s agr√©able, ponctuel et disponible. Une course parfaite depuis la gare.",
    date: "Il y a 4 mois",
  },
  {
    author: "Valentin Giraudet",
    rating: 5,
    text: "Je recommande fortement ce taxi! Tr√®s sympathique, arrangeant et tarifs raisonnables ! Nous avons fait 3 courses dans le week-end avec ce m√™me chauffeur !",
    date: "Il y a 5 mois",
  },
  {
    author: "Jean-Philippe Coutant",
    rating: 5,
    text: "D√©part ce matin √† 4h45 direction l'a√©roport Nantes. Ponctualit√©, excellente conduite et √©changes tr√®s sympathiques ont ponctu√© ce trajet. Je vous recommande vivement Anthony",
    date: "Il y a 8 mois",
  },
  {
    author: "Sophie Meunier",
    rating: 5,
    text: "Quelle chance d'avoir connu Anthony G dans cette p√©riode de traitement si difficile! Je recommande √† 400%, sa conduite est excellentissime! J'√©sp√®re avoir l'occasion de le croiser de nouveau! N'h√©sitez pas une seconde pour vos trajets!",
    date: "Il y a 11 mois",
  },
  {
    author: "Julie Da Gra√ßa Neves",
    rating: 5,
    text: "Anthony a √©t√© super arrangeant, nous avons r√©serv√© 4 voyages avec lui sur un week-end. Hyper disponible et tr√®s r√©actif je vous le recommande vivement !",
    date: "Il y a 1 an",
  },
  {
    author: "J√©r√¥me GORCE",
    rating: 5,
    text: "Au top ! Qualit√© de service, ponctualit√©, amabilit√©, √©changes tr√®s sympathiques, conduite impeccable. Je vous conseille vivement ses services !!! Il m'a r√©concili√© avec la profession dont je n'avais pas forc√©ment de bons souvenirs ! Faites appel √† ses services sans aucune h√©sitation !",
    date: "Il y a 1 an",
  },
  {
    author: "Marion Foulquier",
    rating: 5,
    text: "En panne de voiture avec mes enfants, nous avons √©t√© ravis de tomber sur un chauffeur aussi professionnel, serviable et sympathique pour nous amener √† destination. Recommandation +++ !",
    date: "Il y a 1 an",
  },
  {
    author: "Laurent Mathieu",
    rating: 5,
    text: "Je recommande vivement ce taxi qui a bien voulu accepter ma demande un dimanche soir entre la gare et l'h√¥tel Ibis. Sans √ßa, j'√©tais pied ! Donc, tr√®s bon accueil, tr√®s bon service et tr√®s \"commer√ßant\".",
    date: "Il y a 1 an",
  },
  {
    author: "Ma√´lle Aboukinane",
    rating: 5,
    text: "Franchement super bon trajet avec Anthony il m'a tr√®s clairement sauv√© la vie en me prenant, il est tr√®s agr√©able, tr√®s souriant et c'est tr√®s simple de lui parler et tr√®s √† l'√©coute je recommande vraiment! Merci pour tout encore une fois !",
    date: "Il y a 1 an",
  },
  {
    author: "Canal Franzo",
    rating: 5,
    text: "Anthony est un super chauffeur. √Ä l'heure, il est fiable et vraiment tr√®s sympathique. Aux petits soins pour ses clients/passagers. Il cherche vraiment √† faire au mieux malgr√© certains horaires contraignants. De passage pour un salon litt√©raire √† Jard-sur-mer, il a √©t√© d'une rapidit√© √† toute √©preuve. Un immense merci ! Je recommande √† 100% ses services !",
    date: "Il y a 2 ans",
  },
  {
    author: "Brice ROBERT",
    rating: 5,
    text: "Bon trajet avec Anthony Gervais, ponctuel, met √† l'aise d√®s le d√©but, conduite agr√©able, contact et √©change facile pendant le trajet, voiture confortable. Je recommande.",
    date: "Il y a 1 mois",
  },
  {
    author: "Corentin Boisson",
    rating: 5,
    text: "Je recommande tr√®s fortement Anthony, il conduit tr√®s bien il est super sympathique c'est une tr√®s bonne personne et j'ai pass√© un tr√®s bon trajet √† ses c√¥t√©s üëç",
    date: "Il y a 1 mois",
  },
  {
    author: "Benjamin Carboni",
    rating: 5,
    text: "Tr√®s professionnel ! Conducteur sympathique, vous pouvez lui faire confiance ! Au top",
    date: "Il y a 3 mois",
  },
  {
    author: "weslly godinho",
    rating: 5,
    text: "Il est top, tr√®s gentil et serviable, un vrai gentleman",
    date: "Il y a 3 mois",
  },
  {
    author: "Charles Guesneau",
    rating: 5,
    text: "Taxi intervenu via l'assistance de notre assurance auto sur panne de notre v√©hicule. Intervention r√©active un dimanche soir, appr√©ciable. Aimable, courtois et professionnel.",
    date: "Il y a 5 mois",
  },
  {
    author: "romain Chartier",
    rating: 5,
    text: "Tr√®s bon conducteur √† l'√©coute bonne conduite et avec de la discussion je valide",
    date: "Il y a 6 mois",
  },
  {
    author: "Raphael Mucha",
    rating: 5,
    text: "Prise en charge parfaite par Anthony. Arrangeant, ponctuel et super sympa üëå Parfait ü§ò",
    date: "Il y a 10 mois",
  },
  {
    author: "Nolwenn P",
    rating: 5,
    text: "Tr√®s bonne prise en charge. Tr√®s bonne conduite rapide et efficace je recommande",
    date: "Il y a 11 mois",
  },
  {
    author: "Bob Dolonne",
    rating: 5,
    text: "Ce monsieur a r√©cup√©r√© mon fils en panne de voiture, qui l'a trouv√© fort sympathique, agr√©able et pr√©venant. Il y a des cartes de visites √† conserver, celle-ci en fait partie.",
    date: "Il y a 1 an",
  },
  {
    author: "Ludovic Afonso",
    rating: 5,
    text: "Tomb√© en panne fin avril, notre assurance nous a envoy√© Anthony qui a √©t√© impeccable sur toute la ligne. S√©rieux, professionnel, arrangeant, souriant.",
    date: "Il y a 1 an",
  },
  {
    author: "Pascale Gamby",
    rating: 5,
    text: "Taxi tr√®s agr√©able et professionnel ! On a discut√© pendant tout le trajet. Je recommande vivement !",
    date: "Il y a 1 an",
  },
  {
    author: "Delphine Michaud",
    rating: 5,
    text: "Ponctuel, sympathique, professionnel, et se plie en 4 pour trouver des solutions... Je sais qui appeler lors de mes prochains d√©placements √† la Roche-sur-Yon. Merci",
    date: "Il y a 1 an",
  },
];

const googleReviewsLink =
  "https://www.google.com/search?newwindow=1&sca_esv=454c728905f0b91c&sxsrf=AE3TifNwtmrLBlZ5EzZwWRMQLEtdpGMoMg:1764109083140&q=Taxi+Anthony+Gervais+-+La+Roche+sur+Yon+Avis&rflfq=1&num=20&stick=H4sIAAAAAAAAAONgkxK2NDSwtDAyNbE0NjA0tDS3MDA32cDI-IpRJySxIlPBMa8kIz-vUsE9tagsMbNYQVfBJ1EhKD85I1WhuLRIITI_T8GxLLN4EStJygHgbYl_eAAAAA&rldimm=9109825493011978074&tbm=lcl&hl=fr-FR&sa=X&ved=2ahUKEwjXovu5qo6RAxWrUKQEHbQkLbEQ9fQKegQIKhAF&biw=1728&bih=911&dpr=2#lkt=LocalPoiReviews";
const writeReviewLink =
  "https://www.google.com/search?newwindow=1&sca_esv=454c728905f0b91c&sxsrf=AE3TifNwtmrLBlZ5EzZwWRMQLEtdpGMoMg:1764109083140&q=Taxi+Anthony+Gervais+-+La+Roche+sur+Yon+Avis&rflfq=1&num=20&stick=H4sIAAAAAAAAAONgkxK2NDSwtDAyNbE0NjA0tDS3MDA32cDI-IpRJySxIlPBMa8kIz-vUsE9tagsMbNYQVfBJ1EhKD85I1WhuLRIITI_T8GxLLN4EStJygHgbYl_eAAAAA&rldimm=9109825493011978074&tbm=lcl&hl=fr-FR&sa=X&ved=2ahUKEwjXovu5qo6RAxWrUKQEHbQkLbEQ9fQKegQIKhAF&biw=1728&bih=911&dpr=2#lkt=LocalPoiReviews&lrd=0x48042f5059cd427d:0x7e6c9a051cc6d75a,3,,,,";
---

<section class='py-12 bg-gray-50'>
  <div class='max-w-7xl mx-auto px-4 sm:px-6 lg:px-8'>
    <div class='text-center mb-12'>
      <div class='flex flex-col items-center gap-5'>
        <h2 class='text-3xl font-bold text-slate-900'>
          Ce que nos clients disent
        </h2>
        <div
          class='bg-white px-6 py-3 rounded-lg shadow-md border border-gray-200 flex items-center gap-3'>
          <div class='text-center'>
            <div class='text-2xl font-bold text-slate-900'>5,0</div>
            <div class='text-yellow-400 text-sm flex gap-0.5'>
              <i class='fas fa-star'></i>
              <i class='fas fa-star'></i>
              <i class='fas fa-star'></i>
              <i class='fas fa-star'></i>
              <i class='fas fa-star'></i>
            </div>
          </div>
          <div class='text-gray-600 text-sm border-l border-gray-300 pl-3'>
            <div class='font-semibold'>135 avis</div>
            <div class='text-xs text-gray-500'>Google</div>
          </div>
        </div>
      </div>
      <div class='w-20 h-1 bg-yellow-400 mx-auto mt-6 mb-6'></div>
      <p class='text-gray-600 mx-auto'>
        La satisfaction de nos clients est notre priorit√©.
        <br />
        D√©couvrez leurs t√©moignages sur Google.
      </p>
    </div>

    <div class='relative mb-12'>
      <!-- Bouton pr√©c√©dent -->
      <button
        id='prevBtn'
        class='absolute left-0 top-1/2 -translate-y-1/2 -translate-x-4 z-10 bg-white rounded-full w-12 h-12 shadow-lg hover:shadow-xl transition flex items-center justify-center text-slate-700 hover:text-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed'>
        <i class='fas fa-chevron-left'></i>
      </button>

      <!-- Container du slider -->
      <div class='overflow-hidden -mx-4' id='sliderContainer'>
        <div id='reviewsSlider' class='flex transition-transform duration-500 ease-in-out'>
          {
            reviews.map((review, index) => (
              <div
                class='w-full md:w-1/2 lg:w-1/3 flex-shrink-0 px-4'
                data-index={index}>
                <div class='bg-white p-6 md:p-8 rounded-xl shadow-md hover:shadow-lg transition border border-gray-100 flex flex-col h-full'>
                  <div class='flex items-center mb-4'>
                    <div class='text-yellow-400 text-sm flex'>
                      {[...Array(review.rating)].map(() => (
                        <i class='fas fa-star' />
                      ))}
                    </div>
                    <span class='text-gray-400 text-xs ml-auto'>
                      {review.date}
                    </span>
                  </div>
                  <p class='text-gray-600 italic mb-6 grow'>"{review.text}"</p>
                  <div class='flex items-center mt-auto'>
                    <div class='w-10 h-10 bg-slate-200 rounded-full flex items-center justify-center text-slate-600 font-bold mr-3'>
                      {review.author.charAt(0)}
                    </div>
                    <div>
                      <p class='font-bold text-slate-900 text-sm'>
                        {review.author}
                      </p>
                      <p class='text-xs text-gray-500'>Client Google</p>
                    </div>
                    <i class='fab fa-google text-slate-300 text-xl ml-auto' />
                  </div>
                </div>
              </div>
            ))
          }
        </div>
      </div>

      <!-- Bouton suivant -->
      <button
        id='nextBtn'
        class='absolute right-0 top-1/2 -translate-y-1/2 translate-x-4 z-10 bg-white rounded-full w-12 h-12 shadow-lg hover:shadow-xl transition flex items-center justify-center text-slate-700 hover:text-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed'>
        <i class='fas fa-chevron-right'></i>
      </button>

      <!-- Indicateurs -->
      <div class='flex justify-center gap-2 mt-8' id='indicators'>
        <!-- Sera rempli par JavaScript -->
      </div>
    </div>

    <script>
      const slider = document.getElementById("reviewsSlider");
      const prevBtn = document.getElementById(
        "prevBtn"
      ) as HTMLButtonElement | null;
      const nextBtn = document.getElementById(
        "nextBtn"
      ) as HTMLButtonElement | null;
      const indicators = document.getElementById("indicators");

      if (!slider || !prevBtn || !nextBtn || !indicators) {
        throw new Error("Required elements not found");
      }

      const totalReviews = 24;
      let currentIndex = 0;

      function getReviewsPerPage(): number {
        const width = window.innerWidth;
        if (width >= 1024) return 3; // lg breakpoint
        if (width >= 768) return 2; // md breakpoint
        return 1; // mobile
      }

      function getTotalPages(): number {
        return Math.ceil(totalReviews / getReviewsPerPage());
      }

      function createIndicators() {
        if (!indicators) return;
        indicators.innerHTML = "";
        const totalPages = getTotalPages();
        for (let i = 0; i < totalPages; i++) {
          const dot = document.createElement("button");
          dot.className = "w-2.5 h-2.5 rounded-full transition-all";
          dot.onclick = () => goToPage(i);
          indicators.appendChild(dot);
        }
      }

      function updateSlider() {
        if (!slider || !prevBtn || !nextBtn || !indicators) return;

        const reviewsPerPage = getReviewsPerPage();
        const totalPages = getTotalPages();
        const currentPage = Math.floor(currentIndex / reviewsPerPage);

        // Calculer le d√©calage bas√© sur le nombre d'√©l√©ments par page
        // Chaque "page" d√©place de 100% de la largeur du conteneur
        const offset = currentPage * 100;
        slider.style.transform = `translateX(-${offset}%)`;

        // Mettre √† jour les boutons
        prevBtn.disabled = currentPage === 0;
        nextBtn.disabled = currentPage >= totalPages - 1;

        // Mettre √† jour les indicateurs
        Array.from(indicators.children).forEach((dot, index) => {
          if (index === currentPage) {
            dot.className =
              "w-8 h-2.5 rounded-full bg-yellow-400 transition-all";
          } else {
            dot.className =
              "w-2.5 h-2.5 rounded-full bg-gray-300 transition-all";
          }
        });
      }

      function goToPage(page: number) {
        const reviewsPerPage = getReviewsPerPage();
        currentIndex = page * reviewsPerPage;
        updateSlider();
      }

      function handleResize() {
        const reviewsPerPage = getReviewsPerPage();
        const currentPage = Math.floor(currentIndex / reviewsPerPage);
        currentIndex = currentPage * reviewsPerPage;
        createIndicators();
        updateSlider();
      }

      prevBtn.addEventListener("click", () => {
        const reviewsPerPage = getReviewsPerPage();
        if (currentIndex >= reviewsPerPage) {
          currentIndex -= reviewsPerPage;
          updateSlider();
        }
      });

      nextBtn.addEventListener("click", () => {
        const reviewsPerPage = getReviewsPerPage();
        if (currentIndex < totalReviews - reviewsPerPage) {
          currentIndex += reviewsPerPage;
          updateSlider();
        }
      });

      // G√©rer le redimensionnement avec debounce
      let resizeTimeout: ReturnType<typeof setTimeout>;
      window.addEventListener("resize", () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(handleResize, 150);
      });

      // Initialiser
      createIndicators();
      updateSlider();
    </script>

    <div class='flex flex-col sm:flex-row justify-center items-center gap-4'>
      <a
        href={writeReviewLink}
        target='_blank'
        rel='noopener noreferrer'
        class='bg-yellow-400 text-slate-900 px-8 py-3 rounded-full font-bold hover:bg-yellow-500 transition shadow-lg flex items-center'>
        <i class='fas fa-pen mr-2'></i>
        Donnez votre avis
      </a>
      <a
        href={googleReviewsLink}
        target='_blank'
        rel='noopener noreferrer'
        class='text-slate-600 hover:text-slate-900 font-medium px-6 py-3 transition flex items-center'>
        <i class='fab fa-google mr-2'></i>
        Voir tous les avis
      </a>
    </div>
  </div>
</section>
